#!/bin/bash

set -e

cd "$HOME/.vim/bundle"
pwd

do_git_pull ()
{
    if [ -e .git ]; then
        has_develop=`git branch | grep develop | wc -l`
        if [ "$has_develop" -gt 0 ]; then
            CMD="git checkout develop"
            echo $CMD
            $CMD
        else
            CMD="git checkout master"
            echo $CMD
            $CMD
        fi

        has_upstream=`git remote -v | grep -v ^origin | wc -l`
        if [ "$has_upstream" -gt 0 ]; then
            CMD="git pull"
            echo $CMD
            $CMD
            CMD="git pull upstream master"
            echo $CMD
            $CMD
        else
            CMD="git pull"
            echo $CMD
            $CMD
        fi

        echo --------------------------------------------------------------------------------
    fi
}

for dir in * ; do
    test -d "$dir" || continue
    CMD="(pwd ; cd \"$dir\"; do_git_pull)&"
    eval $CMD
done

cd
pushd "$HOME/.oh-my-zsh/"
git checkout master
git pull
popd
